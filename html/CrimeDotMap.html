<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Data Incubator - Ryan J. Smith</title>
    <script type="text/javascript" src="../js/d3/d3.v3.js"></script>
</head>

<xmp theme="Journal" style="display;none;">

# Creating a Dot Map of Crime

I have downloaded victim-based crime data from 1/1/2010 to 2/21/2015.  This dataset is pretty rich with information like address, coordinates, type of crime, date and time the crime was committed and other fields.  The original dataset contains entries on approximately 250,000 crimes committed during that time period, with crimes categorized into 15 different classes. I have processed the data in Python and Pandas to create a minimal CSV file of instances of "Common Assault" and "Agg. Assault" committed in 2014. The file contains only the latitude and longitude data of these crimes to keep the size minimal (there are still over 11,000 entries).

## Demo

This visualization shows the location of incidents of common assault and aggravated assault reported during 2014.  These incidents are overlayed with a neighborhood map of Baltimore for geographical context.  This dot map is a far superior means of digesting information about crime than those commonly available to the public: typically city-wide or neighborhood-wide counts or raw data files. However, shortcomings are apparent as we are only able to visualize a single type of data (assaults) and not many conclusions are readily available due to the highly dense and overlapping nature of the dots.  This map represents a first step toward effective visualization and modeling of crime data.

<div id="d3Code"></div>

#### Getting the Data

Crime data and neighborhood boundary data was acquired from [Baltimore's Open Data portal](https://data.baltimorecity.gov/).  Data was downloaded directly from the web interface as csv files.

#### Formatting the Data

The neighborhood line data was reformatted from CSV to GEOJSON using the [ogr2ogr web client](http://ogre.adc4gis.com/).

The crime data was loaded into Pandas in Python.  The data was cleaned to remove erroneous entries. The data was filtered to isolate rows corresponding to incidents of common assault and aggravated assault.  Further filtering was applied to isolate incidents from 2014.  In order to keep the final data output small, the latitude and longitude values for each row of the table were extracted into a separate Pandas dataframe.  This dataframe was finally exported to csv.  Additional details and script information is available in [my other figure](/CrimeGridMap.html).

#### Working With the Data in D3

Code for the map was generated by drawing from great mapping examples by [Mike Bostock](http://bost.ocks.org/mike/map/) and [d3noob](http://bl.ocks.org/d3noob/5193723). A mercator projection was generated and applied to the Baltimore neighborhood path data.  This was then drawn on the SVG element with a black stroke.  The crime data (now just a CSV with Lat and Lon columns) was loaded and plotted as points onto the SVG element and styled.  Finally zoom and pan functionality was added.

## D3 Code

    var w = 960;
    var h = 700;
    var ctrLat = 39.29;
    var ctrLon = 76.61;
    var scaleVal = 150000;
    var ctr = {
        Lat: ctrLat,
        Lon: -ctrLon};

    //Create SVG element
    var svg = d3.select("div#d3Code").append("svg")
                .attr("style", "outline: thin solid black;")
                .attr("width", w)
                .attr("height", h);

    var g = svg.append("g");

    // Define map projection
    var projection = d3.geo.mercator()
        .rotate([ctrLon,0])
        .center([0, ctrLat])
        .scale(scaleVal)
        .translate([w / 2, h /2]);

    var path = d3.geo.path()
        .projection(projection);

    // Draw neighborhoods
    d3.json("../data/neighborhoods2010.json", function(error, balt) {
        if (error) return console.error(error);

        g.selectAll("path")
        .data(balt.features)
        .enter()
        .append("path")
        .attr("d", path.projection(projection))
        .style("fill","none")
        .style("stroke", "black");

    });

    //Load Data
    d3.csv("../data/minimalCrimeData.csv", function(crime) {
        
        //Draw data on svg element
        g.selectAll("circle")
        .data(crime)
        .enter()
        .append("circle")
        .attr("cx", function(d) {
            return projection([d.Lon, d.Lat])[0];
        })
        .attr("cy", function(d) {
            return projection([d.Lon, d.Lat])[1];
        })
        .attr("r", 1)
        .attr("fill","red");

    });

     //Draw data on svg element
    g.selectAll("circle")
    .data(ctr)
    .enter()
    .append("circle")
    .attr("cx", function(d) {
        return projection([d.Lon, d.Lat])[0];
    })
    .attr("cy", function(d) {
        return projection([d.Lon, d.Lat])[1];
    })
    .attr("r", 50)
    .attr("fill","red");

    // zoom and pan
    var zoom = d3.behavior.zoom()
        .on("zoom",function() {
            g.attr("transform","translate("+ 
                d3.event.translate.join(",")+")scale("+d3.event.scale+")");
            g.selectAll("path")  
                .attr("d", path.projection(projection)); 
            g.selectAll("circle")
                .attr("d", path.projection(projection));
      });

    svg.call(zoom);


---

<div class="container">
    <div class="row">
        <span class="pull-left">
        <a class="btn btn-primary" href="http://Ryan-J-Smith.github.io/Data-Incubator">Back to landing page</a></span>
        <span class="pull-right">By [Ryan J. Smith](http://www.ryanjsmith.me), 2015</span>
    </div>
</div>

</xmp>

<script src="../js/strapdown/v/0.2/strapdown.js"></script>

<script type="text/javascript">

    "use strict";
    /*global d3:false */
    var w = 960;
    var h = 700;
    var ctrLat = 39.29;
    var ctrLon = 76.61;
    var scaleVal = 150000;
    var ctr = {
        Lat: ctrLat,
        Lon: -ctrLon};

    //Create SVG element
    var svg = d3.select("div#d3Code").append("svg")
                .attr("style", "outline: thin solid black;")
                .attr("width", w)
                .attr("height", h);


    var g = svg.append("g");

    // Define Map Projection
    var projection = d3.geo.mercator()
        .rotate([ctrLon,0])
        .center([0, ctrLat])
        .scale(scaleVal)
        .translate([w / 2, h /2]);

    var path = d3.geo.path()
        .projection(projection);

    // Draw neighborhoods
    d3.json("../data/neighborhoods2010.json", function(error, balt) {
        if (error) return console.error(error);

        g.selectAll("path")
        .data(balt.features)
        .enter()
        .append("path")
        .attr("d", path.projection(projection))
        .style("fill","none")
        .style("stroke", "black");

    });

    //Load Data
    d3.csv("../data/minimalCrimeData.csv", function(crime) {
    	
        //Draw data on svg element
        g.selectAll("circle")
        .data(crime)
        .enter()
        .append("circle")
        .attr("cx", function(d) {
            return projection([d.Lon, d.Lat])[0];
        })
        .attr("cy", function(d) {
            return projection([d.Lon, d.Lat])[1];
        })
        .attr("r", 1)
        .attr("fill","red");

    });

     //Draw data on svg element
    g.selectAll("circle")
    .data(ctr)
    .enter()
    .append("circle")
    .attr("cx", function(d) {
        return projection([d.Lon, d.Lat])[0];
    })
    .attr("cy", function(d) {
        return projection([d.Lon, d.Lat])[1];
    })
    .attr("r", 50)
    .attr("fill","red");

    // zoom and pan
    var zoom = d3.behavior.zoom()
        .on("zoom",function() {
            g.attr("transform","translate("+ 
                d3.event.translate.join(",")+")scale("+d3.event.scale+")");
            g.selectAll("path")  
                .attr("d", path.projection(projection)); 
            g.selectAll("circle")
                .attr("d", path.projection(projection));

      });

    svg.call(zoom);

</script>


</html>